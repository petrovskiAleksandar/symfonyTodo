<script>
    function handleCheck (e, id) {
        fetch(`index.php/save/${id}`, {
            method: 'PATCH',
            body: JSON.stringify({
                status: e.target.checked
            }),
            headers: {
                'Content-type': 'application/json'
            }
        })
    }
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('show-modal-btn').addEventListener('click', () => {
            document.getElementById('add-new-modal').showModal();
        })

        document.getElementById('add-new-btn').addEventListener('click', () => {
            fetch('/index.php/save', {
                method: 'POST',
                body: JSON.stringify({
                    name: document.getElementById('todo-name').value,
                    description: document.getElementById('todo-description').value,
                }),
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            document.getElementById('add-new-modal').close();
        });


    });

</script>

<html>
    <body>
        {% if todos and todos|length %}
            {% for todo in todos %}
                <h1>{{ todo.name }}</h1>
                <p>{{ todo.description }}</p>
                <input type="checkbox" {% if todo.status %} checked {% endif %} onclick="handleCheck(event, {{ todo.id }})">
            {% endfor %}
        {% else %}
            <div style="text-center">
                <h1>No todos found!</h1>
            </div>
        {% endif %}
        <button id="show-modal-btn">Add new todo</button>
        <dialog id="add-new-modal">
            <label>Name for todo</label><br>
            <input id="todo-name"/><br>
            <label>description for todo</label><br>
            <textarea id="todo-description"></textarea><br>
            <button id="add-new-btn">Add!</button>
        </dialog>
    </body>
</html>
